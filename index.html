<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‘ì«€ì¿ íŒ…</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: #ffffff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ì²« í™”ë©´ - ì¹´í˜ ë°°ê²½ ì´ë¯¸ì§€ë§Œ */
    .intro-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-image: url('cafe_bj.jpeg');
      background-size: cover;
      background-position: center;
      z-index: 10;
    }

    .intro-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 0;
    }

    .intro-screen > * {
      position: relative;
      z-index: 1;
    }

    /* ê³µì§€ì‚¬í•­ í™”ë©´ - í° ë°°ê²½ */
    .welcome-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100%;
      padding: 20px;
      overflow-y: auto;
      background: #ffffff;
      position: relative;
    }

    .header {
      background: rgba(245, 245, 245, 0.95);
      backdrop-filter: blur(20px);
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      color: #333;
    }

    .header h1 { font-size: 15px; font-weight: 600; }
    .header p { font-size: 11px; color: rgba(0,0,0,0.6); margin-top: 2px; }

    .chat-container {
      position: relative;
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #ffffff;
      display: flex;
      flex-direction: column;
    }

    .message {
      margin-bottom: 12px;
      display: flex;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.received { justify-content: flex-start; }
    .message.sent { justify-content: flex-end; }

    .bubble {
      max-width: 75%;
      padding: 10px 14px;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.3;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .message.received .bubble {
      background: #f0f0f0;
      color: #333;
      border-bottom-left-radius: 4px;
    }

    .message.sent .bubble {
      background: #0b84ff;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .bubble.image-bubble { padding: 4px; background: transparent; }
    .bubble img { max-width: 100%; border-radius: 14px; display: block; }

    .input-area {
      background: rgba(245, 245, 245, 0.95);
      backdrop-filter: blur(20px);
      padding: 8px 15px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .input-container {
      display: flex;
      align-items: center;
      background: #ffffff;
      border-radius: 18px;
      padding: 6px 10px;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .input-container input {
      flex: 1;
      background: transparent;
      border: none;
      color: #333;
      font-size: 14px;
      padding: 4px 8px;
      outline: none;
    }

    .input-container input::placeholder { color: rgba(0,0,0,0.4); }

    .send-button {
      background: #0b84ff;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-left: 8px;
      transition: opacity 0.2s;
    }

    .send-button:hover { opacity: 0.8; }
    .send-button:disabled { opacity: 0.3; cursor: not-allowed; }

    .send-button svg {
      width: 16px;
      height: 16px;
      fill: white;
    }

    .options-container {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .option-button {
      background: #ffffff;
      color: #0b84ff;
      border: 1px solid #0b84ff;
      padding: 8px 16px;
      border-radius: 18px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .option-button:hover {
      background: #0b84ff;
      color: white;
    }

    .option-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .image-upload-btn {
      background: #ffffff;
      border: 1px solid rgba(0,0,0,0.2);
      border-radius: 18px;
      padding: 10px 20px;
      color: #333;
      cursor: pointer;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }

    .image-upload-btn:hover { background: #f5f5f5; }

    .checkbox-container {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-top: 8px;
      color: #333;
      font-size: 13px;
      padding: 10px;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .checkbox-container input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      margin-top: 2px;
      flex-shrink: 0;
    }

    .checkbox-container label { cursor: pointer; line-height: 1.4; }

    .start-button {
      background: #0b84ff;
      color: white;
      border: none;
      padding: 14px 36px;
      border-radius: 22px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      box-shadow: 0 4px 12px rgba(11, 132, 255, 0.4);
    }

    .start-button:hover { opacity: 0.9; }

    .intro-button {
      background: rgba(255, 255, 255, 0.95);
      color: #0b84ff;
      border: 2px solid #0b84ff;
      padding: 16px 48px;
      border-radius: 30px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
    }

    .intro-button:hover {
      background: #0b84ff;
      color: white;
      transform: scale(1.05);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .welcome-screen h2 {
      font-size: 18px;
      margin-bottom: 16px;
      font-weight: 600;
      color: #333;
      background: white;
      padding: 15px 30px;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .welcome-screen .notice-content {
      font-size: 13px;
      line-height: 1.6;
      color: rgba(0,0,0,0.85);
      text-align: left;
      margin-bottom: 30px;
      max-width: 500px;
      width: 100%;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .welcome-screen .notice-content strong { color: #333; display: block; margin-top: 16px; margin-bottom: 8px; }
    .welcome-screen .notice-content ul { margin-left: 20px; margin-top: 6px; }
    .welcome-screen .notice-content li { margin-bottom: 4px; }

    .notice-divider {
      width: 100%;
      height: 1px;
      background: rgba(0,0,0,0.15);
      margin: 12px 0;
    }

    .contact-link {
      color: #0b84ff;
      text-decoration: none;
      font-weight: 500;
    }

    /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì»¨í…Œì´ë„ˆ */
    .image-preview-container {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .image-preview {
      width: 150px;
      height: 150px;
      border-radius: 12px;
      object-fit: cover;
      border: 2px solid #0b84ff;
    }

    @media (max-width: 768px) {
      .welcome-screen { padding: 15px; }
      .welcome-screen .notice-content { font-size: 12px; padding: 15px; max-width: 100%; }
      .start-button { padding: 12px 28px; font-size: 14px; }
      textarea { max-width: 100% !important; width: 100% !important; }
      .image-preview {
        width: 120px;
        height: 120px;
      }
    }

    @media (max-width: 480px) {
      .welcome-screen .notice-content { font-size: 11px; padding: 12px; }
      .header h1 { font-size: 14px; }
      .header p { font-size: 10px; }
      .start-button { padding: 10px 24px; font-size: 13px; }
      .image-preview {
        width: 100px;
        height: 100px;
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>ğŸ’š ë‘ì«€ì¿ íŒ…</h1>
    <p>ì°¸ì—¬ì ëª¨ì§‘</p>
  </div>

  <div class="chat-container" id="chatContainer">
    <!-- ì¸íŠ¸ë¡œ í™”ë©´ (í´ë¦­ ì‹œ í‘œì‹œ) -->
    <div class="intro-screen" id="introScreen" style="display:flex;">
      <button class="intro-button" onclick="showWelcome()">ì°¸ì—¬í•˜ê¸°</button>
    </div>

    <!-- ê³µì§€ì‚¬í•­ í™”ë©´ -->
    <div class="welcome-screen" id="welcomeScreen" style="display:none;">
      <div class="notice-content">
        <strong>[ë‘ì«€ì¿ íŒ… : ë‘ì«€ì¿  ë§Œë“¤ë©´ì„œ ì†Œê°œíŒ…]</strong>
        ë”±ë”±í•˜ê³  ê° ì¡íŒ ì†Œê°œíŒ… ë§ê³ <br>
        ë‘ì«€ì¿ íŒ… ì–´ë•Œìš”?<br><br>
        ì˜ˆìœ ì¹´í˜ì— í•¨ê»˜ ëª¨ì—¬<br>
        ë‘ì«€ì¿ ë¥¼ ê°™ì´ ë§Œë“¤ë‹¤ ë³´ë©´,<br>
        ì–´ëŠìƒˆ ë§ˆìŒì´ ì—´ë¦¬ê³  ì„œë¡œ ê°€ê¹Œì›Œì§ˆ ê±°ì˜ˆìš”.
        <div class="notice-divider"></div>

        <strong>ğŸ’Œ ë‘ì«€ì¿ íŒ…ì€ ì´ë ‡ê²Œ ì§„í–‰ë¼ìš”</strong>
        <strong>1ë¶€ : ë‘ì«€ì¿  ë§Œë“¤ê¸°</strong>
        ì‚¬ì „ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ í…Œì´ë¸” ë°°ì¹˜ë¡œ<br>
        ì´ìƒí˜•ê³¼ í•¨ê»˜ ë‘ì«€ì¿ ë¥¼ ë§Œë“­ë‹ˆë‹¤.

        <strong>2ë¶€ : ë‘ì«€ì¿  ê¾¸ë¯¸ê¸° & ë¡œí…Œì´ì…˜ íƒ€ì„</strong>
        ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ì´ì„±ì—ê²Œ ì„ ë¬¼í•  ë‘ì«€ì¿ ë¥¼ ê¾¸ë°‰ë‹ˆë‹¤.<br>
        ë™ì‹œì— ë¡œí…Œì´ì…˜ íƒ€ì„ì„ ê°€ì§€ë©° ì—¬ëŸ¬ ì‚¬ëŒë“¤ê³¼ ëŒ€í™”í•©ë‹ˆë‹¤.<br>
        
        <div class="notice-divider"></div>
        ğŸ’—ì™¸ëª¨ì™€ ìŠ¤í™ì´ ê²€ì¦ëœ ë‚¨ë…€ë§Œì„ ì„ ë³„í•˜ì—¬, ì„¤ë ˜ ê°€ë“í•œ ë§Œë‚¨ì„ ì„ ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.ğŸ’—
        <div class="notice-divider"></div>
        
        <strong>ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ëª¨ì§‘ ì¸ì›ìˆ˜</strong>
        ì´ 16ëª… ëª¨ì§‘(ë‚¨,ë…€ ê°ê° 8ëª…)<br>
        
        <div class="notice-divider"></div>
        <strong>ğŸ“ ê¸ˆì•¡</strong>
        59,000ì›<br>
        (ê³„ì¢ŒëŠ” ìŠ¹ì¸ëœ ë¶„ë“¤ì— í•œí•´ ë¬¸ìë¡œ ê°œë³„ ì•ˆë‚´)
        <div class="notice-divider"></div>
        
        <strong> ğŸ¥ ì¥ì†Œ</strong>
        ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ í†µì¼ë¡œ<br>
        ì£¼ì°¨ ë¶ˆê°€<br>
        (ìì„¸í•œ ì£¼ì†ŒëŠ” ìŠ¹ì¸ëœ ë¶„ë“¤ì— í•œí•´ ë¬¸ìë¡œ ê°œë³„ ì•ˆë‚´)
        <div class="notice-divider"></div>
        
        <strong>ğŸ‚ ì°¸ì—¬ ì¡°ê±´</strong>
        <ul>
          <li>1994ë…„ìƒ ~ 2002ë…„ìƒ</li>
          <li>ë‘ì«€ì¿ ë¥¼ ì¢‹ì•„í•˜ëŠ” ë¶„</li>
          <li>174cm ì´ìƒ(ë‚¨ì„±)</li>
        </ul>

        <div class="notice-divider"></div>
        <strong>ğŸ“² ì‹ ì²­ ë°©ë²•</strong>
        í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‘ì«€ì¿ íŒ… ì‹ ì²­ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!<br><br>

        <strong>ğŸ’¬ ì¶”ê°€ ë¬¸ì˜</strong>
        <a href="https://instagram.com/duzzonku_ting" class="contact-link" target="_blank">@duzzonku_ting</a>
      </div>

      <button class="start-button" onclick="startChat()">ì‹ ì²­ì„œ ì‘ì„±í•˜ê¸°</button>
    </div>
  </div>

  <div class="input-area" id="inputArea" style="display:none;">
    <div class="input-container">
      <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€" disabled />
      <button class="send-button" id="sendButton" disabled>
        <svg viewBox="0 0 24 24">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>

  <input type="file" id="hiddenFileInput" accept="image/*" multiple style="display:none;">

  <script>
    // âœ… ë„ˆì˜ Web App URL
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzS0OLGjrNYpzUUAeMWbFCl48OR5xUd6shCcR2r6bPJYs8A4ksIb-MxZHhRCO6j_jQxng/exec";

    let currentStep = 0;
    let userData = {};
    let uploadedImages = [];

    // ì¸íŠ¸ë¡œì—ì„œ ê³µì§€ì‚¬í•­ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” í•¨ìˆ˜
    function showWelcome() {
      document.getElementById('introScreen').style.display = 'none';
      document.getElementById('welcomeScreen').style.display = 'flex';
    }

    const questions = [
      { id: 'greeting1', text: 'ì•ˆë…•í•˜ì„¸ìš”! ë‘ì«€ì¿ íŒ…ì´ì—ìš” ã…ã…', type: 'greeting' },
      { id: 'greeting2', text: 'ì›í™œí•œ ì§„í–‰ì„ ìœ„í•´ ëª‡ ê°€ì§€ ê°œì¸ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆì–´ìš”', type: 'greeting' },
      { id: 'name', text: 'ë¨¼ì € ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš” ğŸ˜Š', type: 'text' },
      { id: 'nickname', text: 'ì†Œê°œíŒ…ì— ì‚¬ìš©í•  ë³„ëª…ì„ ì ì–´ì£¼ì„¸ìš” â­', type: 'text' },
      { id: 'gender', text: 'ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”', type: 'options', options: ['ë‚¨ì„±', 'ì—¬ì„±'] },
      { id: 'age', text: 'ë‚˜ì´ê°€ ì–´ë–»ê²Œ ë˜ì‹œë‚˜ìš”?\n(ì˜ˆ: 2000ë…„ìƒ)', type: 'text' },
      { id: 'height', text: 'í‚¤ê°€ ì–´ë–»ê²Œ ë˜ì‹œë‚˜ìš”?', type: 'text' },
      { id: 'phone', text: 'ì—°ë½ì²˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”\n(ì˜ˆ: 010-1234-5678)', type: 'text' },
      { id: 'job', text: 'ì§ì—…ì´ ë¬´ì—‡ì¸ê°€ìš”?', type: 'text' },
      { id: 'mbti', text: 'MBTIê°€ ë¬´ì—‡ì¸ê°€ìš”?', type: 'options', options: ['ISTJ','ISFJ','INFJ','INTJ','ISTP','ISFP','INFP','INTP','ESTP','ESFP','ENFP','ENTP','ESTJ','ESFJ','ENFJ','ENTJ','ëª¨ë¦„'] },
      { id: 'ideal_type', text: 'ì´ìƒí˜•ì„ ê°„ë‹¨íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”! ğŸ’•', type: 'text' },
      { id: 'self_intro', text: 'ë³¸ì¸ì„ ë‚˜íƒ€ë‚´ëŠ” í•œë§ˆë””! ğŸ¤©', type: 'text' },
      { id: 'photos', text: 'ëª¨ë‘ê°€ ì¦ê±°ìš´ ì†Œì…œë§ì„ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ì§„ ë‘ ì¥ì„ ë°›ê³  ìˆìŠµë‹ˆë‹¤.\n\nì™¸ëª¨ ë° ì‹ ì› í™•ì¸ì„ ìœ„í•œ ê³¼ì •ì´ë‹ˆ ì–‘í•´ ë¶€íƒë“œë ¤ìš”!\në‚¨ë…€ ë˜‘ê°™ì´ í™•ì¸í•˜ê³  ìˆë‹µë‹ˆë‹¤ ã…ã…\n\nì‚¬ì§„ ë‘ ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš” ğŸ“¸', type: 'images' },
      { id: 'beverage', text: 'ê°„ë‹¨í•œ ìŒë£Œë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.\nì»¤í”¼ì™€ ì•„ì´ìŠ¤í‹° ì¤‘ ì–´ë–¤ ê±¸ ì„ í˜¸í•˜ì‹œë‚˜ìš”? â˜•', type: 'options', options: ['ì»¤í”¼','ì•„ì´ìŠ¤í‹°'] },
      { id: 'allergy', text: 'ê²¬ê³¼ë¥˜ ì•ŒëŸ¬ì§€ê°€ ìˆìœ¼ì‹ ê°€ìš”?', type: 'options', options: ['ìˆìŒ','ì—†ìŒ'] },
      { id: 'video', text: '[ì´¬ì˜ ë™ì˜]\n\ní›„ê¸° ì½˜í…ì¸  ì œì‘ì„ ìœ„í•´ ì§„í–‰ì— ë°©í•´ë˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ ì´¬ì˜ì´ ìˆì„ ì˜ˆì •ì…ë‹ˆë‹¤.\n\nì–¼êµ´ì€ ì „ì²´ ëª¨ìì´í¬ ì²˜ë¦¬ë  ì˜ˆì •ì´ë©° ì´ì™¸ì˜ ëª©ì ì—ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', type: 'checkbox' },
      { id: 'privacy', text: '[ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜]\n\nì„œë¹„ìŠ¤ ì œê³µ(ëª©ì )ì„ ìœ„í•´ ìƒê¸° ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ë©°, ìˆ˜ì§‘ëœ ì •ë³´ëŠ” í–‰ì‚¬ ìš´ì˜ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©° í–‰ì‚¬ ì¢…ë£Œ í›„ ìë™ íŒŒê¸°ë©ë‹ˆë‹¤.', type: 'checkbox' },
      { id: 'event_date', text: 'ì°¸ì„ ê°€ëŠ¥í•œ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!', type: 'options', options: ['2/22 (ì¼) 15:30~17:30','3/1 (ì¼) 15:30~17:30','3/8 (ì¼) 15:30~17:30'] }
    ];

    function resetToWelcome() {
      currentStep = 0;
      userData = {};
      uploadedImages = [];
      document.getElementById('chatContainer').innerHTML = '';
      
      // ì¸íŠ¸ë¡œ í™”ë©´ ì¶”ê°€
      const introDiv = document.createElement('div');
      introDiv.className = 'intro-screen';
      introDiv.id = 'introScreen';
      introDiv.style.display = 'flex';
      introDiv.innerHTML = '<button class="intro-button" onclick="showWelcome()">ì°¸ì—¬í•˜ê¸°</button>';
      
      // ê³µì§€ì‚¬í•­ í™”ë©´ ì¶”ê°€
      const welcomeDiv = document.createElement('div');
      welcomeDiv.className = 'welcome-screen';
      welcomeDiv.id = 'welcomeScreen';
      welcomeDiv.style.display = 'none';
      welcomeDiv.innerHTML = `
        <div class="notice-content">
          <strong>[ë‘ì«€ì¿ íŒ… : ë‘ì«€ì¿  ë§Œë“¤ë©´ì„œ ì†Œê°œíŒ…]</strong>
          ë”±ë”±í•˜ê³  ê° ì¡íŒ ì†Œê°œíŒ… ë§ê³ <br>
          ë‘ì«€ì¿ íŒ… ì–´ë•Œìš”?<br><br>
          ì˜ˆìœ ì¹´í˜ì— í•¨ê»˜ ëª¨ì—¬<br>
          ë‘ì«€ì¿ ë¥¼ ê°™ì´ ë§Œë“¤ë‹¤ ë³´ë©´,<br>
          ì–´ëŠìƒˆ ë§ˆìŒì´ ì—´ë¦¬ê³  ì„œë¡œ ê°€ê¹Œì›Œì§ˆ ê±°ì˜ˆìš”.
          <div class="notice-divider"></div>

          <strong>ğŸ’Œ ë‘ì«€ì¿ íŒ…ì€ ì´ë ‡ê²Œ ì§„í–‰ë¼ìš”</strong>
          <strong>1ë¶€ : ë‘ì«€ì¿  ë§Œë“¤ê¸°</strong>
          ì‚¬ì „ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ í…Œì´ë¸” ë°°ì¹˜ë¡œ<br>
          ì´ìƒí˜•ê³¼ í•¨ê»˜ ë‘ì«€ì¿ ë¥¼ ë§Œë“­ë‹ˆë‹¤.

          <strong>2ë¶€ : ë‘ì«€ì¿  ê¾¸ë¯¸ê¸° & ë¡œí…Œì´ì…˜ íƒ€ì„</strong>
          ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ì´ì„±ì—ê²Œ ì„ ë¬¼í•  ë‘ì«€ì¿ ë¥¼ ê¾¸ë°‰ë‹ˆë‹¤.<br>
          ë™ì‹œì— ë¡œí…Œì´ì…˜ íƒ€ì„ì„ ê°€ì§€ë©° ì—¬ëŸ¬ ì‚¬ëŒë“¤ê³¼ ëŒ€í™”í•©ë‹ˆë‹¤.<br>
          
          <div class="notice-divider"></div>
          ğŸ’—ì™¸ëª¨ì™€ ìŠ¤í™ì´ ê²€ì¦ëœ ë‚¨ë…€ë§Œì„ ì„ ë³„í•˜ì—¬, ì„¤ë ˜ ê°€ë“í•œ ë§Œë‚¨ì„ ì„ ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.ğŸ’—
          <div class="notice-divider"></div>
          
          <strong>ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ëª¨ì§‘ ì¸ì›ìˆ˜</strong>
          ì´ 16ëª… ëª¨ì§‘(ë‚¨,ë…€ ê°ê° 8ëª…)<br>
          
          <div class="notice-divider"></div>
          <strong>ğŸ“ ê¸ˆì•¡</strong>
          59,000ì›<br>
          (ê³„ì¢ŒëŠ” ìŠ¹ì¸ëœ ë¶„ë“¤ì— í•œí•´ ë¬¸ìë¡œ ê°œë³„ ì•ˆë‚´)
          <div class="notice-divider"></div>
          
          <strong> ğŸ¥ ì¥ì†Œ</strong>
          ì„œìš¸ì‹œ ì„œëŒ€ë¬¸êµ¬ í†µì¼ë¡œ<br>
          ì£¼ì°¨ ë¶ˆê°€<br>
          (ìì„¸í•œ ì£¼ì†ŒëŠ” ìŠ¹ì¸ëœ ë¶„ë“¤ì— í•œí•´ ë¬¸ìë¡œ ê°œë³„ ì•ˆë‚´)
          <div class="notice-divider"></div>
          
          <strong>ğŸ‚ ì°¸ì—¬ ì¡°ê±´</strong>
          <ul>
            <li>1994ë…„ìƒ ~ 2002ë…„ìƒ</li>
            <li>ë‘ì«€ì¿ ë¥¼ ì¢‹ì•„í•˜ëŠ” ë¶„</li>
            <li>174cm ì´ìƒ(ë‚¨ì„±)</li>
          </ul>

          <div class="notice-divider"></div>
          <strong>ğŸ“² ì‹ ì²­ ë°©ë²•</strong>
          í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‘ì«€ì¿ íŒ… ì‹ ì²­ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!<br><br>

          <strong>ğŸ’¬ ì¶”ê°€ ë¬¸ì˜</strong>
          <a href="https://instagram.com/duzzonku_ting" class="contact-link" target="_blank">@duzzonku_ting</a>
        </div>
        <button class="start-button" onclick="startChat()">ì‹ ì²­ì„œ ì‘ì„±í•˜ê¸°</button>
      `;
      
      document.getElementById('chatContainer').appendChild(introDiv);
      document.getElementById('chatContainer').appendChild(welcomeDiv);
      document.getElementById('inputArea').style.display = 'none';
    }

    function startChat() {
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('inputArea').style.display = 'block';
      askQuestion();
    }

    function addMessage(text, type, isImage = false, imageData = null) {
      const chatContainer = document.getElementById('chatContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;

      const bubble = document.createElement('div');
      bubble.className = isImage ? 'bubble image-bubble' : 'bubble';

      if (isImage && imageData) {
        const img = document.createElement('img');
        img.src = imageData;
        bubble.appendChild(img);
      } else {
        bubble.textContent = text;
      }

      messageDiv.appendChild(bubble);
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function addOptions(options) {
      const chatContainer = document.getElementById('chatContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message received';

      const optionsContainer = document.createElement('div');
      optionsContainer.className = 'options-container';

      options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'option-button';
        button.textContent = option;
        button.onclick = () => handleAnswer(option);
        optionsContainer.appendChild(button);
      });

      messageDiv.appendChild(optionsContainer);
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function addMultiImageUpload() {
      const chatContainer = document.getElementById('chatContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message received';

      const uploadBtn = document.createElement('button');
      uploadBtn.className = 'image-upload-btn';
      uploadBtn.innerHTML = 'ğŸ“· ì‚¬ì§„ 2ì¥ ì„ íƒí•˜ê¸°';
      uploadBtn.onclick = () => {
        document.getElementById('hiddenFileInput').click();
      };

      messageDiv.appendChild(uploadBtn);
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function addCheckbox(questionId) {
      const chatContainer = document.getElementById('chatContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message received';

      const checkboxContainer = document.createElement('div');
      checkboxContainer.className = 'checkbox-container';

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.id = `checkbox_${questionId}`;

      const label = document.createElement('label');
      label.htmlFor = `checkbox_${questionId}`;
      label.textContent = 'ë™ì˜í•©ë‹ˆë‹¤ (í•„ìˆ˜)';

      checkboxContainer.appendChild(checkbox);
      checkboxContainer.appendChild(label);
      messageDiv.appendChild(checkboxContainer);

      // í™•ì¸ ë²„íŠ¼ ì¶”ê°€
      const confirmDiv = document.createElement('div');
      confirmDiv.className = 'message received';
      confirmDiv.style.marginTop = '10px';
      
      const confirmBtn = document.createElement('button');
      confirmBtn.className = 'option-button';
      confirmBtn.textContent = 'ë‹¤ìŒ';
      confirmBtn.style.opacity = '0.5';
      confirmBtn.style.cursor = 'not-allowed';
      confirmBtn.disabled = true;
      
      checkbox.onchange = () => {
        if (checkbox.checked) {
          confirmBtn.style.opacity = '1';
          confirmBtn.style.cursor = 'pointer';
          confirmBtn.disabled = false;
        } else {
          confirmBtn.style.opacity = '0.5';
          confirmBtn.style.cursor = 'not-allowed';
          confirmBtn.disabled = true;
        }
      };
      
      confirmBtn.onclick = () => {
        if (checkbox.checked) {
          handleAnswer('ë™ì˜í•¨', true);
          confirmDiv.remove();
          messageDiv.remove();
        }
      };
      
      confirmDiv.appendChild(confirmBtn);

      chatContainer.appendChild(messageDiv);
      chatContainer.appendChild(confirmDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function askQuestion() {
      if (currentStep >= questions.length) {
        finishChat();
        return;
      }

      const question = questions[currentStep];

      setTimeout(() => {
        addMessage(question.text, 'received');

        if (question.type === 'greeting') {
          currentStep++;
          askQuestion();
        } else if (question.type === 'options') {
          addOptions(question.options);
        } else if (question.type === 'images') {
          addMultiImageUpload();
        } else if (question.type === 'checkbox') {
          addCheckbox(question.id);
        } else if (question.type === 'text') {
          enableInput();
        }
      }, 500);
    }

    function enableInput() {
      const input = document.getElementById('messageInput');
      const button = document.getElementById('sendButton');
      input.disabled = false;
      button.disabled = false;
      input.focus();
    }

    function disableInput() {
      document.getElementById('messageInput').disabled = true;
      document.getElementById('sendButton').disabled = true;
    }

    function handleAnswer(answer, skipDisplay = false) {
      if (!skipDisplay) addMessage(answer, 'sent');

      const question = questions[currentStep];
      userData[question.id] = answer;

      currentStep++;
      disableInput();
      document.getElementById('messageInput').value = '';

      setTimeout(() => askQuestion(), 300);
    }

    document.getElementById('sendButton').addEventListener('click', () => {
      const input = document.getElementById('messageInput');
      const answer = input.value.trim();
      if (answer) handleAnswer(answer);
    });

    document.getElementById('messageInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('sendButton').click();
    });

    function fileToResizedDataUrl(file, quality = 0.7) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            const maxWidth = 800;
            const maxHeight = 800;

            let width = img.width;
            let height = img.height;

            if (width > height) {
              if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; }
            } else {
              if (height > maxHeight) { width *= maxHeight / height; height = maxHeight; }
            }

            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);

            const resized = canvas.toDataURL('image/jpeg', quality);
            resolve(resized);
          };
          img.onerror = reject;
          img.src = reader.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    document.getElementById('hiddenFileInput').addEventListener('change', async (e) => {
      const files = Array.from(e.target.files);
      if (files.length === 0) return;

      if (files.length !== 2) {
        addMessage('ì‚¬ì§„ì„ ì •í™•íˆ 2ì¥ ì„ íƒí•´ì£¼ì„¸ìš”.', 'received');
        e.target.value = '';
        return;
      }

      try {
        const resizedImages = await Promise.all(
          files.map(file => fileToResizedDataUrl(file, 0.7))
        );

        // ì´ë¯¸ì§€ í”„ë¦¬ë·° í‘œì‹œ
        const chatContainer = document.getElementById('chatContainer');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message sent';

        const bubble = document.createElement('div');
        bubble.className = 'bubble';

        const previewContainer = document.createElement('div');
        previewContainer.className = 'image-preview-container';

        resizedImages.forEach(imgData => {
          const img = document.createElement('img');
          img.src = imgData;
          img.className = 'image-preview';
          previewContainer.appendChild(img);
        });

        bubble.appendChild(previewContainer);
        messageDiv.appendChild(bubble);
        chatContainer.appendChild(messageDiv);

        // í™•ì¸ ë²„íŠ¼ ì¶”ê°€
        const confirmDiv = document.createElement('div');
        confirmDiv.className = 'message received';
        
        const buttonsContainer = document.createElement('div');
        buttonsContainer.className = 'options-container';
        
        const confirmBtn = document.createElement('button');
        confirmBtn.className = 'option-button';
        confirmBtn.textContent = 'âœ… ì´ ì‚¬ì§„ìœ¼ë¡œ í• ê²Œìš”';
        confirmBtn.onclick = () => {
          userData['photo1'] = resizedImages[0];
          userData['photo2'] = resizedImages[1];
          uploadedImages = resizedImages;
          currentStep++;
          buttonsContainer.remove();
          confirmDiv.remove();
          setTimeout(() => askQuestion(), 300);
        };
        
        const retryBtn = document.createElement('button');
        retryBtn.className = 'option-button';
        retryBtn.textContent = 'ğŸ”„ ë‹¤ì‹œ ì„ íƒí• ê²Œìš”';
        retryBtn.onclick = () => {
          messageDiv.remove();
          confirmDiv.remove();
          document.getElementById('hiddenFileInput').click();
        };
        
        buttonsContainer.appendChild(confirmBtn);
        buttonsContainer.appendChild(retryBtn);
        confirmDiv.appendChild(buttonsContainer);
        chatContainer.appendChild(confirmDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

      } catch (err) {
        console.error(err);
        addMessage('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'received');
      } finally {
        e.target.value = '';
      }
    });

    async function finishChat() {
      addMessage('ê°ì‚¬í•©ë‹ˆë‹¤! ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‰', 'received');

      const submission = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString('ko-KR'),
        time: new Date().toLocaleTimeString('ko-KR'),
        ...userData
      };

      try {
        const res = await fetch(GAS_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(submission)
        });
        
        let out = { ok: true };
        try {
          out = await res.json();
        } catch (e) {}
        
        if (!res.ok || out.ok === false) {
          throw new Error(out.error || `HTTP ${res.status}`);
        }

        setTimeout(() => resetToWelcome(), 2000);

      } catch (error) {
        console.error("GAS ì €ì¥ ì˜¤ë¥˜:", error);
        addMessage('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'received');
      }
    }

  </script>
</body>
</html>
